<!DOCTYPE html>
<html lang=" en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="openssl,https,ssl/tsl,自签名,证书,数字证书,cert,csr,crt,pem"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>使用OpenSSL自签名证书 | EGSEE’s BLOG</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="使用OpenSSL自签名证书" />
<meta name="author" content="EG" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="导读 网上关于自签证书的博客资料可以说是很多了，但其中的很多写的都是含糊不清的，此篇文章将会尽量清晰的描述自签名证书和创建CA为自己的服务器颁发证书。 什么是数字证书和数字签名 对于这个问题，阮一峰有一篇 文章 比较形象的解释了这个问题，此处，我们主要记录如何生成。" />
<meta property="og:description" content="导读 网上关于自签证书的博客资料可以说是很多了，但其中的很多写的都是含糊不清的，此篇文章将会尽量清晰的描述自签名证书和创建CA为自己的服务器颁发证书。 什么是数字证书和数字签名 对于这个问题，阮一峰有一篇 文章 比较形象的解释了这个问题，此处，我们主要记录如何生成。" />
<link rel="canonical" href="http://localhost:4000/simple-blog/internet/%E4%BD%BF%E7%94%A8OpenSSL%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6" />
<meta property="og:url" content="http://localhost:4000/simple-blog/internet/%E4%BD%BF%E7%94%A8OpenSSL%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6" />
<meta property="og:site_name" content="EGSEE’s BLOG" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-17T21:01:21+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="使用OpenSSL自签名证书" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"EG"},"dateModified":"2021-03-17T21:01:21+08:00","datePublished":"2021-03-17T21:01:21+08:00","description":"导读 网上关于自签证书的博客资料可以说是很多了，但其中的很多写的都是含糊不清的，此篇文章将会尽量清晰的描述自签名证书和创建CA为自己的服务器颁发证书。 什么是数字证书和数字签名 对于这个问题，阮一峰有一篇 文章 比较形象的解释了这个问题，此处，我们主要记录如何生成。","headline":"使用OpenSSL自签名证书","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/simple-blog/internet/%E4%BD%BF%E7%94%A8OpenSSL%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6"},"url":"http://localhost:4000/simple-blog/internet/%E4%BD%BF%E7%94%A8OpenSSL%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/simple-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/simple-blog/feed.xml" title="EGSEE's BLOG" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/simple-blog/">EGSEE&#39;s BLOG</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>
        <div class="trigger"><a class="page-link" href="/simple-blog/about/">About</a><a class="page-link" href="/simple-blog/archives/index">Archives</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content"><div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <style>
      div.post-content img{
          width: 100%;
      }
  </style>
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">使用OpenSSL自签名证书</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-03-17T21:01:21+08:00" itemprop="datePublished">
        Mar 17, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="导读">导读</h2>
<blockquote>
  <p>网上关于自签证书的博客资料可以说是很多了，但其中的很多写的都是含糊不清的，此篇文章将会尽量清晰的描述自签名证书和创建CA为自己的服务器颁发证书。</p>
</blockquote>

<h2 id="什么是数字证书和数字签名">什么是数字证书和数字签名</h2>
<p>对于这个问题，阮一峰有一篇 <strong><a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html">文章</a></strong> 比较形象的解释了这个问题，此处，我们主要记录如何生成。</p>

<!-- more -->
<h2 id="创建ca颁发数字证书">创建CA颁发数字证书</h2>
<p>要给我们的服务器颁发一个<code class="language-plaintext highlighter-rouge">数字证书</code>，我们首先需要自己创建一个证书颁发机构 <code class="language-plaintext highlighter-rouge">CA</code> ，通常情况下，这个CA是真实的颁发机构，我们使用Chrome访问的<code class="language-plaintext highlighter-rouge">https</code>网页时会出现一把锁，这些都是真实的CA颁发的，因此浏览器对此是信任的。</p>
<p></p>

<p><strong>为CA生成一个长度为1024的私钥</strong></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">openssl</span> <span class="n">genrsa</span> <span class="o">-</span><span class="n">out</span> <span class="n">ca</span><span class="p">.</span><span class="n">key</span> <span class="mi">1024</span>
</code></pre></div></div>

<p><strong>生成CA机构自己的证书申请文件(.csr)</strong></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">openssl</span> <span class="n">req</span> <span class="o">-</span><span class="n">new</span> <span class="o">-</span><span class="n">key</span> <span class="n">ca</span><span class="p">.</span><span class="n">key</span> <span class="o">-</span><span class="n">out</span> <span class="n">ca</span><span class="p">.</span><span class="n">csr</span>
</code></pre></div></div>

<p><strong>使用私钥和证书申请文件为CA生成一个自己签名的证书，俗称自签名证书，这里也叫根证书</strong></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">openssl</span> <span class="n">x509</span> <span class="o">-</span><span class="n">req</span> <span class="o">-</span><span class="n">in</span> <span class="n">ca</span><span class="p">.</span><span class="n">csr</span> <span class="o">-</span><span class="n">signkey</span> <span class="n">ca</span><span class="p">.</span><span class="n">key</span> <span class="o">-</span><span class="n">out</span> <span class="n">ca</span><span class="p">.</span><span class="n">crt</span>
</code></pre></div></div>
<blockquote>
  <p>第二个命令中，<code class="language-plaintext highlighter-rouge">req</code>是一个<code class="language-plaintext highlighter-rouge">openssl</code>的一个关于证书请求文件的子命令，可以运行<code class="language-plaintext highlighter-rouge">openssl req --help</code>查看帮助。最后一个命令的<code class="language-plaintext highlighter-rouge">x509</code>是在 <strong><a href="https://baike.baidu.com/item/ASN.1/498523">ASN.1</a></strong> 中定义的 <strong><a href="https://baike.baidu.com/item/X.509/2817050">一种格式</a></strong>，X.509证书里含有公钥、身份信息(比如网络主机名，组织的名称或个体名称等)和签名信息(可以是证书签发机构CA的签名，也可以是自签名)，证书的拥有者就可以用证书及相应的私钥来创建安全的通信，对文档进行数字签名。
在nginx使用https，nginx配置好后只需将<code class="language-plaintext highlighter-rouge">ca.crt</code>颁发给客户端电脑，客户端电脑信任后，浏览器浏览即可看到一把绿锁状态。</p>
</blockquote>

<h3 id="生成服务器私钥">生成服务器私钥</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> server.key 1024
</code></pre></div></div>

<h3 id="生成服务器证书申请文件">生成服务器证书申请文件</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-new</span> <span class="nt">-key</span> server.key <span class="nt">-out</span> server.csr
</code></pre></div></div>
<h3 id="使用ca证书签名服务器证书文件">使用CA证书签名服务器证书文件</h3>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl x509 <span class="nt">-req</span> <span class="nt">-in</span> server.csr <span class="nt">-out</span> server.crt <span class="nt">-CA</span> ca.crt <span class="nt">-CAkey</span> ca.key <span class="nt">-CAcreateserial</span>
</code></pre></div></div>

<h2 id="自签名证书">自签名证书</h2>
<p>自签名证书顾名思义无需CA参与，自己给自己颁发一个证书，流程相对简单</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> server.key 1024
openssl req <span class="nt">-new</span> <span class="nt">-key</span> server.key <span class="nt">-out</span> server.csr
openssl x509 <span class="nt">-req</span> <span class="nt">-in</span> server.csr <span class="nt">-signkey</span> server.key <span class="nt">-out</span> ca.crt
</code></pre></div></div>
<p>也可以省略生成密钥过程，让系统自动生成</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -x509 -nodes -days 365 -newkey rsa:1024 \
-keyout /tmp/server.key -out /tmp/server.crt
</code></pre></div></div>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">-nodes</code> 选项禁止加密私钥文件。
<code class="language-plaintext highlighter-rouge">-days</code> 指定过期时间</p>
</blockquote>

<p>然后输入一些信息：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []: 这个是你的域名或ip
Email Address []:
</code></pre></div></div>
<p>另外也可以只省略证书请求文件，让系统在签署过程中在内存中自动创建证书请求文件</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -new -x509 -key pri.pem -out server.crt -days 365
</code></pre></div></div>
<p>这样一个证书就申请好了。</p>

<h2 id="其它命令">其它命令</h2>
<h3 id="查看证书申请文件">查看证书申请文件</h3>
<p>一个服务器申请文件可通过<code class="language-plaintext highlighter-rouge">openssl req -in req1.csr -noout -text</code>来输出文件头部分，如下:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Certificate Request:
    Data:
        Version: 0 <span class="o">(</span>0x0<span class="o">)</span>
        Subject: <span class="nv">C</span><span class="o">=</span>AU, <span class="nv">ST</span><span class="o">=</span>Some-State, <span class="nv">O</span><span class="o">=</span>Internet Widgits Pty Ltd //个人信息
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption  //使用的公钥算法
                Public-Key: <span class="o">(</span>2048 bit<span class="o">)</span>
                Modulus:
                    00:cf:a2:a6:65:ab:e0:38:73:25:8c:d6:33:94:ba:
                    d9:4f:6c:93:28:bc:05:81:b9:4c:07:02:93:e2:07:
                    c3:0f:57:92:ad:16:e9:57:6f:05:93:44:66:5b:2a:
                    1a:54:5f:80:96:3f:b0:5a:b6:fe:70:fb:a1:4d:f5:
                    cf:d3:fb:10:ec:8a:1c:3b:53:6c:dd:49:a8:d7:61:
                    52:b9:9d:06:e3:94:7a:6f:73:4d:f6:7d:7b:ad:55:
                    bf:85:28:0d:8c:dc:50:72:5d:bb:9d:f8:ed:2a:18:
                    82:f2:03:b6:00:61:7f:ad:ea:36:57:00:8e:77:df:
                    06:00:97:d3:fe:09:35:a6:3d:0d:47:71:24:03:26:
                    3b:b6:37:f3:24:1d:d9:2f:c7:d8:7e:d2:db:08:b2:
                    49:35:6d:4c:d2:d6:57:0d:e8:6f:4c:ae:5e:50:1c:
                    f4:bf:42:df:f1:fb:19:88:eb:0f:05:ad:69:32:da:
                    89:2e:ef:61:e2:95:58:11:27:ba:1c:9f:f4:7f:83:
                    03:de:2f:a6:73:2b:18:b5:46:82:c5:8b:85:19:c0:
                    f4:25:d4:d8:ad:b6:81:9f:e1:b2:6d:ab:eb:ef:ba:
                    2d:f3:06:fa:65:54:8c:14:81:65:4b:d2:48:b4:32:
                    fd:ae:f7:71:6d:8e:dc:9d:a6:87:47:ee:a7:11:3f:
                    ab:a9
                Exponent: 65537 <span class="o">(</span>0x10001<span class="o">)</span>
        Attributes:
            a0:00
    Signature Algorithm: sha256WithRSAEncryption   //请求文件使用的数字签名算法
         95:68:5f:6a:6e:f0:b6:7c:bc:97:c7:c5:ce:76:c0:a8:3f:2a:
         07:61:5f:75:ee:f0:c3:73:51:c9:b9:d7:59:68:67:06:ca:e5:
         a8:d3:68:19:32:27:ff:18:5f:4b:eb:02:6f:7c:f6:85:db:76:
         36:56:90:3f:b6:f9:45:4a:1a:4c:74:a9:28:b1:f9:e9:f2:af:
         2e:4f:d6:38:d5:72:b0:ba:11:36:92:55:9c:a3:48:61:6f:66:
         73:7b:f6:35:91:cf:8a:23:aa:e1:e1:fd:ed:b1:ea:78:6c:0d:
         1b:bf:6c:19:4c:a7:1c:dc:09:bb:a5:3f:2f:b2:aa:77:cb:d5:
         2b:e4:57:bc:14:14:7d:ed:ec:a3:d5:b4:50:93:d3:b0:3a:07:
         49:0b:fa:e7:42:b8:a6:bf:39:ae:bf:c6:66:37:f3:40:2b:59:
         75:ce:c4:08:f4:b1:18:2c:48:17:a8:2c:6d:41:1e:5a:a8:86:
         34:53:a7:ff:fd:e0:95:64:b7:69:9b:86:b7:66:4d:db:74:dc:
         c6:52:18:e9:dc:2a:b0:b1:f9:33:10:a8:d6:0d:1a:ef:0c:ac:
         1b:fc:c7:61:30:ab:80:01:62:21:06:f1:7b:a7:0c:7c:bf:20:
         e8:d2:b6:24:a3:9a:93:ae:94:02:cf:06:23:74:1f:54:ec:16:
         a7:7e:44:b4
</code></pre></div></div>
<p>输出subject部分</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -in req.csr -subject -noout
</code></pre></div></div>
<p>使用<code class="language-plaintext highlighter-rouge">-pubkey</code>输出请求文件中的公钥</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -in req1.csr -pubkey -noout
</code></pre></div></div>
<p>如果是从申请证书请求时所提供的私钥中提取出公钥，那么以下输出的公钥和上面相同。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> openssl rsa -in server.key -pubout
</code></pre></div></div>
<h3 id="指定证书请求文件中的签名算法">指定证书请求文件中的签名算法</h3>
<p>如果不指定此项，默认为<code class="language-plaintext highlighter-rouge">sha256</code>，也支持其它很多签名算法，可以通过使用<code class="language-plaintext highlighter-rouge">openssl dgst --help</code>查看</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -new -key server.key -out server.csr -md5
openssl req -in server.csr -noout -text | grep Algo
</code></pre></div></div>
<h3 id="验证请求文件的数字签名验证文件是否被篡改">验证请求文件的数字签名（验证文件是否被篡改）</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -verify -in server.csr //未被篡改会打印verify OK
</code></pre></div></div>


  </div><a class="u-url" href="/simple-blog/internet/%E4%BD%BF%E7%94%A8OpenSSL%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6" hidden></a>
</article>

        </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/simple-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/simple-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/simple-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">EG</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>EGSEE&#39;s BLOG / Copyright©️2022
</p>
      </div>
    </div>

    <!-- <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/jekyll" target="_blank" title="jekyll"><svg class="svg-icon grey"><use xlink:href="/simple-blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/jekyllrb" target="_blank" title="jekyllrb"><svg class="svg-icon grey"><use xlink:href="/simple-blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div> -->
    <!-- scripts -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha384-q9CRHqZndzlxGLOj+xrdLDJa9ittGte1NksRmgJKeCV9DrM7Kz868XYqsKWPpAmn" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-YSu1vEueMOXZYSSiTgjRD6egOBAdWrKI6AQBdHjTtvftX42GZLCVzwlxm0RJuipa" crossorigin="anonymous"></script> -->

  </div>

</footer>
</body>

</html>