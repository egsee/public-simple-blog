<!DOCTYPE html><html lang=" en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Javascript typed arrays | EGSEE’s BLOG</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Javascript typed arrays" /><meta name="author" content="EG" /><meta property="og:locale" content="en_US" /><meta name="description" content="类型数组视图 类型化数组视图具有自描述性的名字和所有常用的数值类型像Int8，Uint32，Float64 等等。有一种特殊类型的数组Uint8ClampedArray。它仅操作 0 到 255 之间的数值。例如，这对于Canvas 数据处理非常有用。" /><meta property="og:description" content="类型数组视图 类型化数组视图具有自描述性的名字和所有常用的数值类型像Int8，Uint32，Float64 等等。有一种特殊类型的数组Uint8ClampedArray。它仅操作 0 到 255 之间的数值。例如，这对于Canvas 数据处理非常有用。" /><link rel="canonical" href="http://localhost:4000/frontend/TypedArrays" /><meta property="og:url" content="http://localhost:4000/frontend/TypedArrays" /><meta property="og:site_name" content="EGSEE’s BLOG" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-18T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Javascript typed arrays" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"EG"},"dateModified":"2022-05-18T00:00:00+08:00","datePublished":"2022-05-18T00:00:00+08:00","description":"类型数组视图 类型化数组视图具有自描述性的名字和所有常用的数值类型像Int8，Uint32，Float64 等等。有一种特殊类型的数组Uint8ClampedArray。它仅操作 0 到 255 之间的数值。例如，这对于Canvas 数据处理非常有用。","headline":"Javascript typed arrays","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/frontend/TypedArrays"},"url":"http://localhost:4000/frontend/TypedArrays"}</script><link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="EGSEE's BLOG" /><header class="site-header"><div class="wrapper"><a class="site-title" rel="author" href="/">EGSEE&#39;s BLOG</a><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/> </svg> </span> </label><div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/archives/index">Archives</a></div></nav></div></header><main class="page-content" aria-label="Content"><div class="wrapper"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><style> div.post-content img{ width: 100%; }</style><header class="post-header"><h1 class="post-title p-name" itemprop="name headline">Javascript typed arrays</h1><p class="post-meta"><time class="dt-published" datetime="2022-05-18T00:00:00+08:00" itemprop="datePublished"> May 18, 2022 </time></p></header><div class="post-content e-content" itemprop="articleBody"><p><img src="/assets/img/posts/typedArray1.png" alt="图片" /></p><h2 id="类型数组视图">类型数组视图</h2><p>类型化数组视图具有自描述性的名字和所有常用的数值类型像<code class="language-plaintext highlighter-rouge">Int8</code>，<code class="language-plaintext highlighter-rouge">Uint32</code>，<code class="language-plaintext highlighter-rouge">Float64</code> 等等。有一种特殊类型的数组<code class="language-plaintext highlighter-rouge">Uint8ClampedArray</code>。它仅操作 0 到 255 之间的数值。例如，这对于<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ImageData">Canvas 数据处理</a>非常有用。</p><table><thead><tr><th style="text-align: left">Type<th style="text-align: left">Value Range<th style="text-align: left">Size in bytes<th style="text-align: left">Description<th style="text-align: left">Web IDL type<th style="text-align: left">Equivalent C type<tbody><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int8Array"><code class="language-plaintext highlighter-rouge">Int8Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-128</code> to <code class="language-plaintext highlighter-rouge">127</code><td style="text-align: left">1<td style="text-align: left">8-bit two’s complement signed integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">byte</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">int8_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code class="language-plaintext highlighter-rouge">Uint8Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">255</code><td style="text-align: left">1<td style="text-align: left">8-bit unsigned integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">octet</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint8_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray"><code class="language-plaintext highlighter-rouge">Uint8ClampedArray</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">255</code><td style="text-align: left">1<td style="text-align: left">8-bit unsigned integer (clamped)<td style="text-align: left"><code class="language-plaintext highlighter-rouge">octet</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint8_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int16Array"><code class="language-plaintext highlighter-rouge">Int16Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-32768</code> to <code class="language-plaintext highlighter-rouge">32767</code><td style="text-align: left">2<td style="text-align: left">16-bit two’s complement signed integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">short</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">int16_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array"><code class="language-plaintext highlighter-rouge">Uint16Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">65535</code><td style="text-align: left">2<td style="text-align: left">16-bit unsigned integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">unsigned short</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint16_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int32Array"><code class="language-plaintext highlighter-rouge">Int32Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-2147483648</code> to <code class="language-plaintext highlighter-rouge">2147483647</code><td style="text-align: left">4<td style="text-align: left">32-bit two’s complement signed integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">long</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">int32_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array"><code class="language-plaintext highlighter-rouge">Uint32Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">4294967295</code><td style="text-align: left">4<td style="text-align: left">32-bit unsigned integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">unsigned long</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint32_t</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="language-plaintext highlighter-rouge">Float32Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-3.4E38</code> to <code class="language-plaintext highlighter-rouge">3.4E38</code> and <code class="language-plaintext highlighter-rouge">1.2E-38</code> is the min positive number<td style="text-align: left">4<td style="text-align: left">32-bit IEEE floating point number (7 significant digits e.g., <code class="language-plaintext highlighter-rouge">1.234567</code>)<td style="text-align: left"><code class="language-plaintext highlighter-rouge">unrestricted float</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">float</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float64Array"><code class="language-plaintext highlighter-rouge">Float64Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-1.8E308</code> to <code class="language-plaintext highlighter-rouge">1.8E308</code> and <code class="language-plaintext highlighter-rouge">5E-324</code> is the min positive number<td style="text-align: left">8<td style="text-align: left">64-bit IEEE floating point number (16 significant digits e.g., <code class="language-plaintext highlighter-rouge">1.23456789012345</code>)<td style="text-align: left"><code class="language-plaintext highlighter-rouge">unrestricted double</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">double</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt64Array"><code class="language-plaintext highlighter-rouge">BigInt64Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-2^63</code> to <code class="language-plaintext highlighter-rouge">2^63 - 1</code><td style="text-align: left">8<td style="text-align: left">64-bit two’s complement signed integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">bigint</code><td style="text-align: left"><code class="language-plaintext highlighter-rouge">int64_t (signed long long)</code><tr><td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigUint64Array"><code class="language-plaintext highlighter-rouge">BigUint64Array</code></a><td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">2^64 - 1</code><td style="text-align: left">8<td style="text-align: left">64-bit unsigned integer<td style="text-align: left"><code class="language-plaintext highlighter-rouge">bigint</code><td style="text-align: left"> </table><h2 id="使用复杂的数据结构">使用复杂的数据结构</h2><p>通过将缓冲与不同类型视图组合，以及修改内存访问的偏移位置，你可以操作包含更多更复杂数据结构的数据。你可以使用 <code class="language-plaintext highlighter-rouge">js-ctypes</code> 操作诸如 <code class="language-plaintext highlighter-rouge">WebGL</code>，数据文件或 C 语言结构体这些复杂的数据结构。</p><p>请看如下的 C 语言结构:</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">someStruct</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">username</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">amountDue</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div><p>你可以采用如下代码访问一个包含此类结构体的缓冲：</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>

<span class="c1">// ... read the data into the buffer ...</span>

<span class="kd">var</span> <span class="nx">idView</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint32Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">usernameView</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">amountDueView</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Float32Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div><p>现在你就可以通过<code class="language-plaintext highlighter-rouge">amountDueView[0]</code>的方式访问数量。</p><blockquote><p>备注：C 语言结构体的数据对齐与平台相关。因此需要防范和考虑不同平台的字节填充对齐。</p></blockquote><h2 id="转换为普通数组">转换为普通数组</h2><p>在处理完一个类型化数组后，有时需要把它转为普通数组，以便可以可以像普通数据一种操作访问。可以调用 <code class="language-plaintext highlighter-rouge">Array.from</code>实现这种转换，如果 <code class="language-plaintext highlighter-rouge">Array.from</code> 不支持的话，也可以通过如下代码实现：</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">typedArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span>
  <span class="nx">normalArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">typedArray</span><span class="p">);</span>
<span class="nx">normalArray</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">4</span><span class="p">;</span>
<span class="nx">normalArray</span><span class="p">.</span><span class="kd">constructor</span> <span class="o">===</span> <span class="nb">Array</span><span class="p">;</span>
</code></pre></div></div><h2 id="参考">参考</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">JavaScript typed arrays</a><br /> <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays">缓冲和视图：类型数组架构</a></p></div><a class="u-url" href="/frontend/TypedArrays" hidden></a></article></div></main><footer class="site-footer h-card"> <data class="u-url" href="/"></data><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col"><p class="feed-subscribe"> <a href="/feed.xml"> <svg class="svg-icon orange"> <use xlink:href="/assets/minima-social-icons.svg#rss"></use> </svg><span>Subscribe</span> </a></p><ul class="contact-list"><li class="p-name">EG</ul></div><div class="footer-col"><p>EGSEE&#39;s BLOG / Copyright©️2022</p></div></div></div></footer>
