<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://blog.egsee.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://blog.egsee.com/" rel="alternate" type="text/html" /><updated>2022-08-02T15:02:23+08:00</updated><id>https://blog.egsee.com/feed.xml</id><title type="html">EGSEE’s BLOG</title><subtitle>EGSEE's BLOG / Copyright©️2022
</subtitle><author><name>EG</name></author><entry><title type="html">centos重置为默认官方镜像源</title><link href="https://blog.egsee.com/fragment/centos%E9%87%8D%E5%BB%BA%E6%9B%B4%E6%8D%A2%E4%B8%BA%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E6%BA%90" rel="alternate" type="text/html" title="centos重置为默认官方镜像源" /><published>2022-05-22T05:13:16+08:00</published><updated>2022-05-22T05:13:16+08:00</updated><id>https://blog.egsee.com/fragment/centos%E9%87%8D%E5%BB%BA%E6%9B%B4%E6%8D%A2%E4%B8%BA%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E6%BA%90</id><content type="html" xml:base="https://blog.egsee.com/fragment/centos%E9%87%8D%E5%BB%BA%E6%9B%B4%E6%8D%A2%E4%B8%BA%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E6%BA%90"><![CDATA[<p><strong>1. 备份当前yum源配置</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>复制cd /etc/yum.repos.d/
rename repo repo.old CentOS-<span class="k">*</span>.repo
</code></pre></div></div>

<p><strong>2. 重建官方yum源</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>复制rpm <span class="nt">-Uvh</span> <span class="nt">--force</span> http://mirror.centos.org/centos-7/7.9.2009/os/x86_64/Packages/centos-release-7-9.2009.0.el7.centos.x86_64.rpm
</code></pre></div></div>
<!-- more -->

<p><strong>3. 重建缓存</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>复制yum clean all
yum makecache
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="fragment" /><category term="centos" /><summary type="html"><![CDATA[1. 备份当前yum源配置 复制cd /etc/yum.repos.d/ rename repo repo.old CentOS-*.repo 2. 重建官方yum源 复制rpm -Uvh --force http://mirror.centos.org/centos-7/7.9.2009/os/x86_64/Packages/centos-release-7-9.2009.0.el7.centos.x86_64.rpm]]></summary></entry><entry><title type="html">centos locale警告</title><link href="https://blog.egsee.com/fragment/centos-locale%E8%AD%A6%E5%91%8A" rel="alternate" type="text/html" title="centos locale警告" /><published>2022-05-22T04:13:16+08:00</published><updated>2022-05-22T04:13:16+08:00</updated><id>https://blog.egsee.com/fragment/centos%20locale%E8%AD%A6%E5%91%8A</id><content type="html" xml:base="https://blog.egsee.com/fragment/centos-locale%E8%AD%A6%E5%91%8A"><![CDATA[<p>zh_CN</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># vim /etc/profile.d/locale.sh</span>
<span class="nb">export </span><span class="nv">LC_CTYPE</span><span class="o">=</span>zh_CN.UTF-8
<span class="nb">export </span><span class="nv">LC_ALL</span><span class="o">=</span>zh_CN.UTF-8

<span class="c"># vim /etc/locale.conf</span>
<span class="nv">LANG</span><span class="o">=</span>zh_CN.UTF-8

<span class="c"># vim /etc/sysconfig/i18n</span>
<span class="nv">LANG</span><span class="o">=</span>zh_CN.UTF-8

<span class="c"># vim /etc/environment</span>
<span class="nv">LANG</span><span class="o">=</span>zh_CN.UTF-8
<span class="nv">LC_ALL</span><span class="o">=</span>zh_CN.UTF-8
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> /etc/profile.d/locale.sh
</code></pre></div></div>

<!-- more -->

<ul>
  <li>en_US</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># vim /etc/profile.d/locale.sh</span>
<span class="nb">export </span><span class="nv">LC_CTYPE</span><span class="o">=</span>en_US.UTF-8
<span class="nb">export </span><span class="nv">LC_ALL</span><span class="o">=</span>en_US.UTF-8

<span class="c"># vim /etc/locale.conf</span>
<span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8

<span class="c"># vim /etc/sysconfig/i18n</span>
<span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8

<span class="c"># vim /etc/environment</span>
<span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
<span class="nv">LC_ALL</span><span class="o">=</span>en_US.UTF-8
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="fragment" /><category term="centos" /><summary type="html"><![CDATA[zh_CN # vim /etc/profile.d/locale.sh export LC_CTYPE=zh_CN.UTF-8 export LC_ALL=zh_CN.UTF-8 # vim /etc/locale.conf LANG=zh_CN.UTF-8 # vim /etc/sysconfig/i18n LANG=zh_CN.UTF-8 # vim /etc/environment LANG=zh_CN.UTF-8 LC_ALL=zh_CN.UTF-8 source /etc/profile.d/locale.sh]]></summary></entry><entry><title type="html">undefined symbol php_json_decode_ex in unknown on line 0</title><link href="https://blog.egsee.com/fragment/php-redis%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD" rel="alternate" type="text/html" title="undefined symbol php_json_decode_ex in unknown on line 0" /><published>2022-05-22T04:13:16+08:00</published><updated>2022-05-22T04:13:16+08:00</updated><id>https://blog.egsee.com/fragment/php%20redis%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD</id><content type="html" xml:base="https://blog.egsee.com/fragment/php-redis%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD"><![CDATA[<p>通过remi安装的php<br />
然后通过pecl安装redis扩展 报如下错误：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PHP Warning:  PHP Startup: Unable to load dynamic library <span class="s1">'redis'</span> <span class="o">(</span>tried: /opt/remi/php74/root/usr/lib64/php/modules/redis <span class="o">(</span>/opt/remi/php74/root/usr/lib64/php/modules/redis: cannot open shared object file: No such file or directory<span class="o">)</span>, /opt/remi/php74/root/usr/lib64/php/modules/redis.so <span class="o">(</span>/opt/remi/php74/root/usr/lib64/php/modules/redis.so: undefined symbol: php_json_decode_ex<span class="o">))</span> <span class="k">in </span>Unknown on line 0
</code></pre></div></div>
<p>这是由于redis加载顺序需要再json扩展之后<br />
在 <code class="language-plaintext highlighter-rouge">/etc/opt/remi/php74/php.d</code> 新建 <code class="language-plaintext highlighter-rouge">redis.ini</code>，其中加入<code class="language-plaintext highlighter-rouge">extension=redis.so</code>即可。</p>

<h3 id="参考">参考</h3>
<p><a href="https://github.com/phpredis/phpredis/issues/1589#issuecomment-508412700">php undefined symbol</a><br />
<a href="https://bugs.php.net/bug.php?id=67140">php bug 67140</a><br />
<a href="https://bugs.php.net/bug.php?id=59267">php bug 59267</a><br />
<a href="https://stackoverflow.com/questions/56998659/php-warning-redis-so-undefined-symbol-php-json-decode-ex-in-unknown-on-line-0">PHP Warning: redis.so: undefined symbol::stackoverflow</a></p>]]></content><author><name>EG</name></author><category term="fragment" /><category term="php" /><category term="linux" /><summary type="html"><![CDATA[通过remi安装的php 然后通过pecl安装redis扩展 报如下错误： PHP Warning: PHP Startup: Unable to load dynamic library 'redis' (tried: /opt/remi/php74/root/usr/lib64/php/modules/redis (/opt/remi/php74/root/usr/lib64/php/modules/redis: cannot open shared object file: No such file or directory), /opt/remi/php74/root/usr/lib64/php/modules/redis.so (/opt/remi/php74/root/usr/lib64/php/modules/redis.so: undefined symbol: php_json_decode_ex)) in Unknown on line 0 这是由于redis加载顺序需要再json扩展之后 在 /etc/opt/remi/php74/php.d 新建 redis.ini，其中加入extension=redis.so即可。 参考 php undefined symbol php bug 67140 php bug 59267 PHP Warning: redis.so: undefined symbol::stackoverflow]]></summary></entry><entry><title type="html">Docker CentOS 初始化</title><link href="https://blog.egsee.com/fragment/Docker-CentOS%E5%88%9D%E5%A7%8B%E5%8C%96" rel="alternate" type="text/html" title="Docker CentOS 初始化" /><published>2022-05-21T04:13:16+08:00</published><updated>2022-05-21T04:13:16+08:00</updated><id>https://blog.egsee.com/fragment/Docker%20CentOS%E5%88%9D%E5%A7%8B%E5%8C%96</id><content type="html" xml:base="https://blog.egsee.com/fragment/Docker-CentOS%E5%88%9D%E5%A7%8B%E5%8C%96"><![CDATA[<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--name</span> centos <span class="nt">--privileged</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-d</span> centos /usr/sbin/init
 
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/mirrorlsit/#mirrorlist/g'</span> /etc/yum.repos.d/CentOS-<span class="k">*</span>

<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g'</span> /etc/yum.repos.d/CentOS-<span class="k">*</span>

yum makecache
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="fragment" /><category term="centos" /><summary type="html"><![CDATA[docker run --name centos --privileged=true -d centos /usr/sbin/init sed -i 's/mirrorlsit/#mirrorlist/g' /etc/yum.repos.d/CentOS-* sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-* yum makecache]]></summary></entry><entry><title type="html">Elasticsearch常用查询</title><link href="https://blog.egsee.com/elasticsearch/Elasticsearch%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2" rel="alternate" type="text/html" title="Elasticsearch常用查询" /><published>2022-05-18T00:00:00+08:00</published><updated>2022-05-18T00:00:00+08:00</updated><id>https://blog.egsee.com/elasticsearch/Elasticsearch%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2</id><content type="html" xml:base="https://blog.egsee.com/elasticsearch/Elasticsearch%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2"><![CDATA[<h2 id="简单查询">简单查询</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">GET</span> <span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">books</span><span class="o">/</span><span class="n">_search</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 查询index为library,type为books中price等于10的</span>
<span class="no">GET</span> <span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">books</span><span class="o">/</span><span class="n">_search</span><span class="o">?</span><span class="n">q</span><span class="o">=</span><span class="nl">price:</span><span class="mi">10</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// filter_path过滤返回字段</span>
<span class="no">GET</span> <span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">books</span><span class="o">/</span><span class="n">_search</span><span class="o">?</span><span class="n">q</span><span class="o">=</span><span class="nl">price:</span><span class="mi">10</span><span class="o">&amp;</span><span class="n">filter_path</span><span class="o">=</span><span class="n">hits</span><span class="o">.</span><span class="na">total</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 指定_source返回字段</span>
<span class="no">GET</span> <span class="n">schools</span><span class="o">/</span><span class="n">_doc</span><span class="o">/</span><span class="mi">5</span><span class="o">?</span><span class="n">_source_includes</span><span class="o">=</span><span class="n">name</span><span class="o">,</span><span class="n">fees</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 获取source源部分</span>
<span class="no">GET</span> <span class="n">schools</span><span class="o">/</span><span class="n">_doc</span><span class="o">/</span><span class="mi">5</span><span class="o">?</span><span class="n">_source</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 查看集群的节点</span>
<span class="no">GET</span> <span class="nl">http:</span><span class="c1">//localhost:9200/_cat/?v</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 查看所有索引</span>
<span class="no">GET</span> <span class="nl">http:</span><span class="c1">//localhost:9200/_cat/indices?v</span>
</code></pre></div></div>

<!-- more -->

<ul>
  <li>创建索引时加入别名</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">/twitte</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"aliases"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"alias_1"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
        </span><span class="nl">"alias_2"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"term"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"user"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"kimchy"</span><span class="w"> </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"routing"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"kimchy"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>设置回默认值，用 null</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PUT</span><span class="w"> </span><span class="err">/twitter/_settings</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"index"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"refresh_interval"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="普通查询">普通查询</h2>

<h3 id="match_all-查询">match_all 查询</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">/library/books/_search</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"match_all"</span><span class="p">:{}</span><span class="w">
        </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">partial</span><span class="w"> </span><span class="err">过滤出包含preview的字段和排除title,price的字段</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"partial_fields"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"partial"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"include"</span><span class="p">:[</span><span class="s2">"preview"</span><span class="p">],</span><span class="w">         </span><span class="err">//包含preview字段的文档</span><span class="w">
            </span><span class="nl">"exclude"</span><span class="p">:[</span><span class="s2">"title,price"</span><span class="p">]</span><span class="w">      </span><span class="err">//排除title</span><span class="p">,</span><span class="w"> </span><span class="err">price字段</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"match_all"</span><span class="p">:[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="match-查询">match 查询</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"desc"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"包含苹果的查询"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">or</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"desc"</span><span class="p">:</span><span class="s2">"包含苹果的查询"</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="match_phrase-和-term-查询">match_phrase 和 term 查询</h3>

<p>该查询完全匹配，不进行分词</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">match_phrase</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"match_phrase"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"desc"</span><span class="p">:</span><span class="s2">"包含苹果的查询"</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">term</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"desc"</span><span class="p">:</span><span class="s2">"包含苹果的查询"</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="multi_match-查询">multi_match 查询</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"multi_match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"包含苹果的查询"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"desc"</span><span class="p">,</span><span class="w"> </span><span class="s2">"content"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">让完全匹配的文档占的评分较高</span><span class="w"> </span><span class="err">需要使用best_fields</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"multi_match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"包含苹果的查询"</span><span class="p">,</span><span class="w">
        </span><span class="err">//</span><span class="w"> </span><span class="err">越多字段匹配的文档评分越高</span><span class="w"> </span><span class="err">使用most_fields</span><span class="w">
        </span><span class="err">//</span><span class="w"> </span><span class="err">如果希望这个词条的分词词汇是分配到不同字段中</span><span class="w"> </span><span class="err">使用cross_fields</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"best_fields"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"desc"</span><span class="p">,</span><span class="w"> </span><span class="s2">"content"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"tie_breaker"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="bool-联合查询">bool 联合查询</h3>

<p>有时候我们需要查询比如这样的例子：
在内容中(content)包含<strong>苹果</strong>查询但在<code class="language-plaintext highlighter-rouge">title</code>中不包含，就要使用这样的联合查询</p>

<p>例：”name”==”a” and (“city” == “b” or “city” == “c”) 这样的查询：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"match_phrase"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"match_phrase"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"match_phrase"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"mininum_should_matach"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>must: 文档必须完全匹配条件</li>
  <li>should: should 下面会带一个以上的条件，至少满足一个条件，这个文档就符合 should</li>
  <li>must_not: 文档必须不匹配条件</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"评估"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"must_not"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"苹果"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="must-和-should-查询">must 和 should 查询</h3>

<p>must 和 should 类型 and 和 or</p>

<ul>
  <li>AND</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_test_info</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="s1">'123'</span> <span class="k">AND</span> <span class="n">t</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="s1">'p'</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"kv.p.keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"kv.p.keywords"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"must_not"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"sort"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"aggs"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>IN</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_test_info</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">ip</span> <span class="k">in</span> <span class="p">(</span><span class="s1">'1'</span> <span class="p">,</span> <span class="s1">'2'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>OR</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_test_info</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">ip</span> <span class="o">=</span> <span class="s1">'123'</span> <span class="k">or</span> <span class="n">t</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="s1">'l'</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"t.kv.b"</span><span class="p">:</span><span class="w"> </span><span class="s2">"l"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nl">"must_not"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>NOT IN</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_test_info</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">client_ip</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'2'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"must_not"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="err">//</span><span class="w"> </span><span class="err">或其它字段</span><span class="w">
          </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nl">"must_not"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="filterrange-等复合查询">filter、range 等复合查询</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="k">g</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">t_test_info</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="s1">'h'</span> <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="o">@</span><span class="nb">timestamp</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nv">"2020-01-01"</span><span class="p">)</span> <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="o">@</span><span class="nb">timestamp</span> <span class="o">=&lt;</span> <span class="p">(</span><span class="nv">"2020-07-15"</span><span class="p">)</span> <span class="k">and</span> <span class="n">kv</span><span class="p">.</span><span class="k">g</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span> <span class="k">group</span> <span class="k">by</span> <span class="n">t</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="k">g</span> <span class="p">;</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"exists"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kv.g"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"kv.b"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"h"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"@timestamp"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"gte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"lte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-07-15"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"aggs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"kv"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kv.g.keyword"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="聚合查询">聚合查询</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">executionTime</span><span class="p">)</span> <span class="k">from</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">executionDate</span> <span class="k">between</span> <span class="s1">'A'</span> <span class="k">AND</span> <span class="s1">'B'</span> <span class="k">group</span> <span class="k">by</span> <span class="n">executionDate</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">executionDate</span> <span class="k">ASC</span>
</code></pre></div></div>

<p>将 <code class="language-plaintext highlighter-rouge">executionDate</code>分组，然后进行聚合</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"executionDate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"gte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-01-01"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"lte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-01-01"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"aggregations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"executionDateGroup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">分组</span><span class="w">
      </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"executionDate"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">聚合</span><span class="w">
    </span><span class="nl">"aggregations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"executionTimeAvg"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"avg"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"executionTime"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="例子">例子</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET</span><span class="w"> </span><span class="err">_search</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"match_all"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="err">GET</span><span class="w"> </span><span class="err">/private_chat_index/_search?filter_path=hits</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"toUid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"gte"</span><span class="p">:</span><span class="w"> </span><span class="mi">1652840210000</span><span class="p">,</span><span class="w">
            </span><span class="nl">"lte"</span><span class="p">:</span><span class="w"> </span><span class="mi">1652840236500</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">GET</span><span class="w"> </span><span class="err">/private_chat_index/_search?filter_path=hits</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">},</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"toUid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"bool"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"must"</span><span class="p">:[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"toUid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">},</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="参考">参考</h2>

<p>https://blog.csdn.net/AyubLIbra/article/details/106239129</p>]]></content><author><name>EG</name></author><category term="elasticsearch" /><summary type="html"><![CDATA[简单查询 GET /library/books/_search // 查询index为library,type为books中price等于10的 GET /library/books/_search?q=price:10 // filter_path过滤返回字段 GET /library/books/_search?q=price:10&amp;filter_path=hits.total // 指定_source返回字段 GET schools/_doc/5?_source_includes=name,fees // 获取source源部分 GET schools/_doc/5?_source // 查看集群的节点 GET http://localhost:9200/_cat/?v // 查看所有索引 GET http://localhost:9200/_cat/indices?v]]></summary></entry><entry><title type="html">Javascript typed arrays</title><link href="https://blog.egsee.com/frontend/TypedArrays" rel="alternate" type="text/html" title="Javascript typed arrays" /><published>2022-05-18T00:00:00+08:00</published><updated>2022-05-18T00:00:00+08:00</updated><id>https://blog.egsee.com/frontend/TypedArrays</id><content type="html" xml:base="https://blog.egsee.com/frontend/TypedArrays"><![CDATA[<p><img src="//assets/img/posts/typedArray1.png" alt="图片" /></p>

<h2 id="类型数组视图">类型数组视图</h2>
<p>类型化数组视图具有自描述性的名字和所有常用的数值类型像<code class="language-plaintext highlighter-rouge">Int8</code>，<code class="language-plaintext highlighter-rouge">Uint32</code>，<code class="language-plaintext highlighter-rouge">Float64</code> 等等。有一种特殊类型的数组<code class="language-plaintext highlighter-rouge">Uint8ClampedArray</code>。它仅操作 0 到 255 之间的数值。例如，这对于<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ImageData">Canvas 数据处理</a>非常有用。</p>

<!-- more -->

<table>
  <thead>
    <tr>
      <th style="text-align: left">Type</th>
      <th style="text-align: left">Value Range</th>
      <th style="text-align: left">Size in bytes</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Web IDL type</th>
      <th style="text-align: left">Equivalent C type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int8Array"><code class="language-plaintext highlighter-rouge">Int8Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-128</code> to <code class="language-plaintext highlighter-rouge">127</code></td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">8-bit two’s complement signed integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">byte</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">int8_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code class="language-plaintext highlighter-rouge">Uint8Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">255</code></td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">8-bit unsigned integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">octet</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint8_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray"><code class="language-plaintext highlighter-rouge">Uint8ClampedArray</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">255</code></td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">8-bit unsigned integer (clamped)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">octet</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint8_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int16Array"><code class="language-plaintext highlighter-rouge">Int16Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-32768</code> to <code class="language-plaintext highlighter-rouge">32767</code></td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">16-bit two’s complement signed integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">short</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">int16_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array"><code class="language-plaintext highlighter-rouge">Uint16Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">65535</code></td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">16-bit unsigned integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">unsigned short</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint16_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int32Array"><code class="language-plaintext highlighter-rouge">Int32Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-2147483648</code> to <code class="language-plaintext highlighter-rouge">2147483647</code></td>
      <td style="text-align: left">4</td>
      <td style="text-align: left">32-bit two’s complement signed integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">long</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">int32_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array"><code class="language-plaintext highlighter-rouge">Uint32Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">4294967295</code></td>
      <td style="text-align: left">4</td>
      <td style="text-align: left">32-bit unsigned integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">unsigned long</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">uint32_t</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="language-plaintext highlighter-rouge">Float32Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-3.4E38</code> to <code class="language-plaintext highlighter-rouge">3.4E38</code> and <code class="language-plaintext highlighter-rouge">1.2E-38</code> is the min positive number</td>
      <td style="text-align: left">4</td>
      <td style="text-align: left">32-bit IEEE floating point number (7 significant digits e.g., <code class="language-plaintext highlighter-rouge">1.234567</code>)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">unrestricted float</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">float</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float64Array"><code class="language-plaintext highlighter-rouge">Float64Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-1.8E308</code> to <code class="language-plaintext highlighter-rouge">1.8E308</code> and <code class="language-plaintext highlighter-rouge">5E-324</code> is the min positive number</td>
      <td style="text-align: left">8</td>
      <td style="text-align: left">64-bit IEEE floating point number (16 significant digits e.g., <code class="language-plaintext highlighter-rouge">1.23456789012345</code>)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">unrestricted double</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">double</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt64Array"><code class="language-plaintext highlighter-rouge">BigInt64Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-2^63</code> to <code class="language-plaintext highlighter-rouge">2^63 - 1</code></td>
      <td style="text-align: left">8</td>
      <td style="text-align: left">64-bit two’s complement signed integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">bigint</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">int64_t (signed long long)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigUint64Array"><code class="language-plaintext highlighter-rouge">BigUint64Array</code></a></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">2^64 - 1</code></td>
      <td style="text-align: left">8</td>
      <td style="text-align: left">64-bit unsigned integer</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">bigint</code></td>
      <td style="text-align: left"> </td>
    </tr>
  </tbody>
</table>

<h2 id="使用复杂的数据结构">使用复杂的数据结构</h2>

<p>通过将缓冲与不同类型视图组合，以及修改内存访问的偏移位置，你可以操作包含更多更复杂数据结构的数据。你可以使用 <code class="language-plaintext highlighter-rouge">js-ctypes</code> 操作诸如 <code class="language-plaintext highlighter-rouge">WebGL</code>，数据文件或 C 语言结构体这些复杂的数据结构。</p>

<p>请看如下的 C 语言结构:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">someStruct</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">username</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">amountDue</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>你可以采用如下代码访问一个包含此类结构体的缓冲：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>

<span class="c1">// ... read the data into the buffer ...</span>

<span class="kd">var</span> <span class="nx">idView</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint32Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">usernameView</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">amountDueView</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Float32Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>现在你就可以通过<code class="language-plaintext highlighter-rouge">amountDueView[0]</code>的方式访问数量。</p>

<blockquote>
  <p>备注：C 语言结构体的数据对齐与平台相关。因此需要防范和考虑不同平台的字节填充对齐。</p>
</blockquote>

<h2 id="转换为普通数组">转换为普通数组</h2>

<p>在处理完一个类型化数组后，有时需要把它转为普通数组，以便可以可以像普通数据一种操作访问。可以调用 <code class="language-plaintext highlighter-rouge">Array.from</code>实现这种转换，如果 <code class="language-plaintext highlighter-rouge">Array.from</code> 不支持的话，也可以通过如下代码实现：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">typedArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span>
  <span class="nx">normalArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">typedArray</span><span class="p">);</span>
<span class="nx">normalArray</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">4</span><span class="p">;</span>
<span class="nx">normalArray</span><span class="p">.</span><span class="kd">constructor</span> <span class="o">===</span> <span class="nb">Array</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="参考">参考</h2>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">JavaScript typed arrays</a><br />
<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays">缓冲和视图：类型数组架构</a></p>]]></content><author><name>EG</name></author><category term="frontend" /><summary type="html"><![CDATA[类型数组视图 类型化数组视图具有自描述性的名字和所有常用的数值类型像Int8，Uint32，Float64 等等。有一种特殊类型的数组Uint8ClampedArray。它仅操作 0 到 255 之间的数值。例如，这对于Canvas 数据处理非常有用。]]></summary></entry><entry><title type="html">MappedSuperclass注解</title><link href="https://blog.egsee.com/java/SuperMapped%E6%B3%A8%E8%A7%A3" rel="alternate" type="text/html" title="MappedSuperclass注解" /><published>2022-05-10T00:00:00+08:00</published><updated>2022-05-10T00:00:00+08:00</updated><id>https://blog.egsee.com/java/SuperMapped%E6%B3%A8%E8%A7%A3</id><content type="html" xml:base="https://blog.egsee.com/java/SuperMapped%E6%B3%A8%E8%A7%A3"><![CDATA[<p>当进行实体类到表的映射时，有些表可能有共同的属性，它们需要一个公共的封装父类，以定义公共属性，这时候就需要<code class="language-plaintext highlighter-rouge">MappedSuperclass</code>这个注解。
它表示，该类不是一个实体类，但继承它属性的实体类会将其属性映射到数据表中。</p>

<p>可以使用<code class="language-plaintext highlighter-rouge">@AttributeOverrides</code>注解重定义父类的属性，如下：
<!-- more --></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 
     <span class="nd">@MappedSuperclass</span>
     <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
     
         <span class="nd">@Id</span> <span class="kd">protected</span> <span class="nc">Integer</span> <span class="n">empId</span><span class="o">;</span>
         <span class="nd">@Version</span> <span class="kd">protected</span> <span class="nc">Integer</span> <span class="n">version</span><span class="o">;</span>
         <span class="nd">@ManyToOne</span> 
         <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"ADDR"</span><span class="o">)</span>
         <span class="kd">protected</span> <span class="nc">Address</span> <span class="n">address</span><span class="o">;</span>
     
         <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getEmpId</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmpId</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
         <span class="kd">public</span> <span class="nc">Address</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="nc">Address</span> <span class="n">addr</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
     <span class="o">}</span>
     
     <span class="c1">// Default table is FTEMPLOYEE table</span>
     <span class="nd">@Entity</span>
     <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FTEmployee</span> <span class="kd">extends</span> <span class="nc">Employee</span> <span class="o">{</span>
     
         <span class="c1">// Inherited empId field mapped to FTEMPLOYEE.EMPID</span>
         <span class="c1">// Inherited version field mapped to FTEMPLOYEE.VERSION</span>
         <span class="c1">// Inherited address field mapped to FTEMPLOYEE.ADDR fk</span>
     
         <span class="c1">// Defaults to FTEMPLOYEE.SALARY</span>
         <span class="kd">protected</span> <span class="nc">Integer</span> <span class="n">salary</span><span class="o">;</span>
     
         <span class="kd">public</span> <span class="nf">FTEmployee</span><span class="o">()</span> <span class="o">{}</span>
     
         <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getSalary</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
     
         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSalary</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
     <span class="o">}</span>
     
     <span class="nd">@Entity</span>
     <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"PT_EMP"</span><span class="o">)</span>
     <span class="nd">@AssociationOverride</span><span class="o">(</span>
         <span class="n">name</span><span class="o">=</span><span class="s">"address"</span><span class="o">,</span> 
         <span class="n">joincolumns</span><span class="o">=</span><span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"ADDR_ID"</span><span class="o">))</span>
     <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PartTimeEmployee</span> <span class="kd">extends</span> <span class="nc">Employee</span> <span class="o">{</span>
     
         <span class="c1">// Inherited empId field mapped to PT_EMP.EMPID</span>
         <span class="c1">// Inherited version field mapped to PT_EMP.VERSION</span>
         <span class="c1">// address field mapping overridden to PT_EMP.ADDR_ID fk</span>
         <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"WAGE"</span><span class="o">)</span>
         <span class="kd">protected</span> <span class="nc">Float</span> <span class="n">hourlyWage</span><span class="o">;</span>
     
         <span class="kd">public</span> <span class="nf">PartTimeEmployee</span><span class="o">()</span> <span class="o">{}</span>
     
         <span class="kd">public</span> <span class="nc">Float</span> <span class="nf">getHourlyWage</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHourlyWage</span><span class="o">(</span><span class="nc">Float</span> <span class="n">wage</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
     <span class="o">}</span>
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="java" /><summary type="html"><![CDATA[当进行实体类到表的映射时，有些表可能有共同的属性，它们需要一个公共的封装父类，以定义公共属性，这时候就需要MappedSuperclass这个注解。 它表示，该类不是一个实体类，但继承它属性的实体类会将其属性映射到数据表中。 可以使用@AttributeOverrides注解重定义父类的属性，如下：]]></summary></entry><entry><title type="html">Table注解</title><link href="https://blog.egsee.com/java/java-table%E6%B3%A8%E8%A7%A3" rel="alternate" type="text/html" title="Table注解" /><published>2022-05-07T00:00:00+08:00</published><updated>2022-05-07T00:00:00+08:00</updated><id>https://blog.egsee.com/java/java-table%E6%B3%A8%E8%A7%A3</id><content type="html" xml:base="https://blog.egsee.com/java/java-table%E6%B3%A8%E8%A7%A3"><![CDATA[<p>当实体类与其映射表的表名不同的时候，通常会使用<code class="language-plaintext highlighter-rouge">@Table</code>标注说明。</p>

<ul>
  <li>指定表名</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"customers"</span><span class="o">)</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="nc">GenearationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>对应 DDL:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`customers`</span><span class="p">(</span>
    <span class="nv">`ID`</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`Name`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`Email`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`ID`</span><span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">INNODB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div></div>
<!-- more -->

<ul>
  <li>指定数据库名</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"customers"</span><span class="o">,</span> <span class="n">catalog</span><span class="o">=</span><span class="s">"test"</span><span class="o">)</span>
<span class="c1">// 或</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"customers"</span><span class="o">,</span> <span class="n">schema</span><span class="o">=</span><span class="s">"test"</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>约束条件</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"customers"</span><span class="o">,</span><span class="n">uniqueConstraints</span><span class="o">={</span><span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span><span class="o">={</span><span class="s">"name"</span><span class="o">,</span><span class="s">"email"</span><span class="o">})})</span>
</code></pre></div></div>
<p>对应DDL:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`customers`</span><span class="p">(</span>
    <span class="nv">`ID`</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`Name`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`Email`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`ID`</span><span class="p">)</span>
     <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`UK_fda123af112as122l8z1`</span> <span class="p">(</span><span class="nv">`Name`</span><span class="p">,</span><span class="nv">`Email`</span><span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">INNODB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div></div>
<p>uniqueConstraints是数组，可指定多组约束：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"cusotmers"</span><span class="o">,</span> <span class="n">uniqueConstraints</span><span class="o">={</span><span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span><span class="o">={</span><span class="s">"name,email"</span><span class="o">}),</span><span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span><span class="o">={</span><span class="s">"name"</span><span class="o">})})</span>
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="java" /><summary type="html"><![CDATA[当实体类与其映射表的表名不同的时候，通常会使用@Table标注说明。 指定表名 @Table(name="customers") @Entity public class Customer { @Id @GeneratedValue(strategy=GenearationType.IDENTITY) private Integer id; private String name; private String email; } 对应 DDL: CREATE TABLE `customers`( `ID` INT(11) NOT NULL AUTO_INCREMENT, `Name` VARCHAR(255) DEFAULT NULL, `Email` VARCHAR(255) DEFAULT NULL, PRIMARY KEY(`ID`) )ENGINE=INNODB DEFAULT CHARSET=utf8;]]></summary></entry><entry><title type="html">centos nginx install</title><link href="https://blog.egsee.com/fragment/centos-nginx-install" rel="alternate" type="text/html" title="centos nginx install" /><published>2022-01-22T04:13:16+08:00</published><updated>2022-01-22T04:13:16+08:00</updated><id>https://blog.egsee.com/fragment/centos%20nginx%20install</id><content type="html" xml:base="https://blog.egsee.com/fragment/centos-nginx-install"><![CDATA[<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> wget 
yum <span class="nb">install</span> <span class="nt">-y</span> gcc-c++  pcre pcre-devel zlib zlib-devel openssl openssl-devel
yum <span class="nb">install</span> <span class="nt">-y</span> gcc automake autoconf libtool make //automake
wget <span class="nt">-c</span> https://nginx.org/download/nginx-1.23.0.tar.gz
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure --prefix=/usr/local/nginx

//...

Configuration summary
  + using system PCRE2 library
  + OpenSSL library is not used
  + using system zlib library

  nginx path prefix: "/usr/local/nginx"
  nginx binary file: "/usr/local/nginx/sbin/nginx"
  nginx modules path: "/usr/local/nginx/modules"
  nginx configuration prefix: "/usr/local/nginx/conf"
  nginx configuration file: "/usr/local/nginx/conf/nginx.conf"
  nginx pid file: "/usr/local/nginx/logs/nginx.pid"
  nginx error log file: "/usr/local/nginx/logs/error.log"
  nginx http access log file: "/usr/local/nginx/logs/access.log"
  nginx http client request body temporary files: "client_body_temp"
  nginx http proxy temporary files: "proxy_temp"
  nginx http fastcgi temporary files: "fastcgi_temp"
  nginx http uwsgi temporary files: "uwsgi_temp"
  nginx http scgi temporary files: "scgi_temp"

</code></pre></div></div>

<h3 id="add-ngx_http_echo_module">add ngx_http_echo_module</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-c</span> https://github.com/openresty/echo-nginx-module/releases/tag/v0.62
<span class="nb">tar</span> <span class="nt">-zxvf</span> v0.62

<span class="nb">cd</span> /path/to/nginx-resource
<span class="c"># 生成makefile</span>
./configure <span class="nt">--prefix</span><span class="o">=</span>/usr/local/nginx <span class="se">\</span>
 <span class="nt">--modules-path</span><span class="o">=</span>/usr/local/nginx/modules <span class="se">\</span>
 <span class="nt">--with-http_ssl_module</span> <span class="se">\</span>
 <span class="nt">--with-http_stub_status_module</span> <span class="se">\</span>
 <span class="nt">--add-dynamic-module</span><span class="o">=</span>/path/to/echo-nginx-module

<span class="c">#</span>
make

<span class="c"># 复制.so</span>
<span class="nb">cp </span>objs/ngx_http_echo_module.so /usr/local/nginx/modules

<span class="c"># nginx.conf</span>
load_module /usr/local/nginx/modules/ngx_http_echo_module.so<span class="p">;</span>

<span class="c"># start</span>
nginx <span class="nt">-c</span> /usr/local/nginx/conf/nginx.conf
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="fragment" /><category term="centos" /><summary type="html"><![CDATA[yum install -y wget yum install -y gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel yum install -y gcc automake autoconf libtool make //automake wget -c https://nginx.org/download/nginx-1.23.0.tar.gz ./configure --prefix=/usr/local/nginx //... Configuration summary + using system PCRE2 library + OpenSSL library is not used + using system zlib library nginx path prefix: "/usr/local/nginx" nginx binary file: "/usr/local/nginx/sbin/nginx" nginx modules path: "/usr/local/nginx/modules" nginx configuration prefix: "/usr/local/nginx/conf" nginx configuration file: "/usr/local/nginx/conf/nginx.conf" nginx pid file: "/usr/local/nginx/logs/nginx.pid" nginx error log file: "/usr/local/nginx/logs/error.log" nginx http access log file: "/usr/local/nginx/logs/access.log" nginx http client request body temporary files: "client_body_temp" nginx http proxy temporary files: "proxy_temp" nginx http fastcgi temporary files: "fastcgi_temp" nginx http uwsgi temporary files: "uwsgi_temp" nginx http scgi temporary files: "scgi_temp" add ngx_http_echo_module wget -c https://github.com/openresty/echo-nginx-module/releases/tag/v0.62 tar -zxvf v0.62 cd /path/to/nginx-resource # 生成makefile ./configure --prefix=/usr/local/nginx \ --modules-path=/usr/local/nginx/modules \ --with-http_ssl_module \ --with-http_stub_status_module \ --add-dynamic-module=/path/to/echo-nginx-module # make # 复制.so cp objs/ngx_http_echo_module.so /usr/local/nginx/modules # nginx.conf load_module /usr/local/nginx/modules/ngx_http_echo_module.so; # start nginx -c /usr/local/nginx/conf/nginx.conf]]></summary></entry><entry><title type="html">Go edit replace</title><link href="https://blog.egsee.com/go/Go-edit-replace" rel="alternate" type="text/html" title="Go edit replace" /><published>2022-01-01T00:00:00+08:00</published><updated>2022-01-01T00:00:00+08:00</updated><id>https://blog.egsee.com/go/Go%20edit%20replace</id><content type="html" xml:base="https://blog.egsee.com/go/Go-edit-replace"><![CDATA[<p>如果一个go模块尚未发布，我们无法直接使用模块路径进行导入。这时候可以使用go mod edit。假设<code class="language-plaintext highlighter-rouge">exmaple.com/hello</code>依赖于<code class="language-plaintext highlighter-rouge">example.com/greeting</code></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// 其中 ../greetings 为文件夹路径，可以与模块名不同</span>
<span class="err">$</span> <span class="k">go</span> <span class="n">mod</span> <span class="n">edit</span> <span class="o">-</span><span class="n">repalce</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">greeting</span><span class="o">=../</span><span class="n">greetings</span>
<span class="c">// 然后运行</span>
<span class="err">$</span> <span class="k">go</span> <span class="n">mod</span> <span class="n">tidy</span>
</code></pre></div></div>
<!-- more -->
<p>这会在go.mod中生成以下内容:</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">replace</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">greetings</span> <span class="o">=&gt;</span> <span class="o">../</span><span class="n">greetings</span>

<span class="n">require</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">greetings</span> <span class="n">v0</span><span class="m">.0.0</span><span class="o">-</span><span class="m">00010101000000</span><span class="o">-</span><span class="m">000000000000</span>
</code></pre></div></div>]]></content><author><name>EG</name></author><category term="go" /><category term="go" /><summary type="html"><![CDATA[如果一个go模块尚未发布，我们无法直接使用模块路径进行导入。这时候可以使用go mod edit。假设exmaple.com/hello依赖于example.com/greeting // 其中 ../greetings 为文件夹路径，可以与模块名不同 $ go mod edit -repalce example.com/greeting=../greetings // 然后运行 $ go mod tidy]]></summary></entry></feed>